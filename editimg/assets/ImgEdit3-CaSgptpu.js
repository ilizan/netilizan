import{bO as A,aS as c,aQ as J,u as w,H as E,t as M,b9 as O,bi as q,v as u,G as z,bJ as K,bz as Q,aK as k}from"./index-BAi-_Ng5.js";const j={class:"image-uploader"},Z={key:1,class:"preview-container"},$={class:"img-box",style:{position:"relative",width:"400px",height:"400px",border:"1px solid red"}},ee=["src"],te=["src"],ae={__name:"ImgEdit3",setup(ne){const h=c(""),p=c(null),x=c(!1);let g=c(!1),a=c([]);const f=c(1),b=c(),P=c(),W=()=>{p.value.click()},B=e=>{const l=e.target.files[0];if(l){if(!l.type.startsWith("image/")){alert("请选择图片文件！"),_();return}const o=new FileReader;o.onload=s=>{h.value=s.target.result},o.readAsDataURL(l)}},D=()=>{h.value="",_()},_=()=>{p.value&&(p.value.value="")};function H(e){if(!x.value||!g.value)return;const l=e.target,o=l.getBoundingClientRect(),s=e.clientX-o.left,n=e.clientY-o.top,t=l.getContext("2d"),r=T(s,n);if(r!==-1)r===0&&a.value.length>2&&(g.value=!1,C(t,l,!0));else{if(t.fillStyle="#409EFF",t.beginPath(),t.arc(s,n,5,0,Math.PI*2),t.fill(),a.value.length>0){const i=a.value[a.value.length-1];t.strokeStyle="#409EFF",t.lineWidth=3,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s,n),t.stroke()}g.value=!0,a.value.push({x:s,y:n})}}function R(e){if(!g.value||a.value.length===0)return;const l=e.target,o=l.getBoundingClientRect(),s=e.clientX-o.left,n=e.clientY-o.top,t=l.getContext("2d"),r=T(s,n);C(t,l,!1,r);const i=a.value[a.value.length-1];t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s,n),t.stroke()}function C(e,l,o=!1,s=-1){if(e.clearRect(0,0,l.width,l.height),e.fillStyle="#409EFF",e.strokeStyle="#409EFF",e.lineWidth=3,o&&a.value.length>2){e.fillStyle="rgba(255, 255, 255, .6)",e.beginPath(),e.moveTo(a.value[0].x,a.value[0].y);for(let n=1;n<a.value.length;n++)e.lineTo(a.value[n].x,a.value[n].y);e.closePath(),e.fill()}for(let n=0;n<a.value.length;n++){const t=a.value[n],r=n===s?8:5;if(e.beginPath(),e.arc(t.x,t.y,r,0,Math.PI*2),e.fill(),n>0){const i=a.value[n-1];e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(t.x,t.y),e.stroke()}}o&&a.value.length>1&&(e.beginPath(),e.moveTo(a.value[a.value.length-1].x,a.value[a.value.length-1].y),e.lineTo(a.value[0].x,a.value[0].y),e.stroke())}function T(e,l){for(let o=0;o<a.value.length;o++){const s=a.value[o],n=s.x-e,t=s.y-l;if(Math.sqrt(n*n+t*t)<=5)return o}return-1}const I=c(),L=c();async function N(){x.value=!0,a.value=[],g.value=!0}c({}),c("");const m=J({x:0,y:0});async function V(){const e=b.value,l=a.value.map(v=>({x:(v.x-m.x)/f.value,y:(v.y-m.y)/f.value})),o=l.map(v=>v.x),s=l.map(v=>v.y),n=Math.min(...o),t=Math.min(...s),r=Math.max(...o),i=Math.max(...s),Y=r-n,G=i-t,y=document.createElement("canvas");y.width=Y,y.height=G;const d=y.getContext("2d");d.save(),d.beginPath(),l.forEach((v,U)=>{const F=v.x-n,S=v.y-t;U===0?d.moveTo(F,S):d.lineTo(F,S)}),d.closePath(),d.clip(),d.drawImage(e,-n,-t),d.restore(),I.value=y.toDataURL("image/png")}function X(){const e=b.value,l=e.naturalWidth,o=e.naturalHeight,s=400,n=400,t=s/l,r=n/o;f.value=Math.min(t,r),m.x=(s-l*f.value)/2,m.y=(n-o*f.value)/2;const i=P.value;i.width=400,i.height=400}return(e,l)=>(k(),w("div",j,[E(O(q(a))+" ",1),h.value?M("",!0):(k(),w("div",{key:0,class:"upload-area",onClick:W},[u("input",{type:"file",ref_key:"fileInput",ref:p,accept:"image/*",onChange:B,class:"file-input"},null,544),l[0]||(l[0]=z('<div class="upload-hint" data-v-9c9c0e04><svg class="icon" viewBox="0 0 24 24" width="48" height="48" stroke="currentColor" stroke-width="2" fill="none" data-v-9c9c0e04><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-9c9c0e04></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-9c9c0e04></circle><polyline points="21 15 16 10 5 21" data-v-9c9c0e04></polyline></svg><p data-v-9c9c0e04>点击上传图片</p><p class="hint-text" data-v-9c9c0e04>支持 JPG、PNG、WebP 等格式</p></div>',1))])),h.value?(k(),w("div",Z,[u("div",$,[u("img",{src:h.value,alt:"预览图",ref_key:"cropperimage",ref:b,class:"preview-image",onLoad:X},null,40,ee),K(u("canvas",{ref_key:"drawingcanvas",ref:P,class:"drawing_canvas",onClick:H,onMousemove:R,width:"400",height:"400"},null,544),[[Q,x.value]])]),u("div",null,[u("button",{type:"button",onClick:N},"钢笔模式"),u("button",{type:"primary",onClick:V},"确认裁剪")]),l[1]||(l[1]=E(" 输出原图： ",-1)),u("img",{src:I.value,style:{"max-width":"100%"}},null,8,te),u("canvas",{ref_key:"resultCanvas",ref:L},null,512),u("button",{onClick:D,class:"clear-btn"},"清除图片")])):M("",!0)]))}},oe=A(ae,[["__scopeId","data-v-9c9c0e04"]]);export{oe as default};
