import{bO as X,aS as i,aQ as I,u as k,v as n,t as M,H as r,bJ as Y,bz as O,b9 as E,aK as C}from"./index-BAi-_Ng5.js";const j=["src"],z=["src"],J={__name:"ImgEdit2",setup(K){const R=i(""),y=i(""),b=i(null),f=i(null),w=i(null),g=i(1),x=I({x:0,y:0}),v=i(!1),o=I([]);function H(e){const t=e.target.files[0];R.value=URL.createObjectURL(t)}function W(){o.length=0,v.value=!v.value,f.value&&f.value.getContext("2d").clearRect(0,0,200,200)}function D(){const e=b.value,t=e.naturalWidth,s=e.naturalHeight,c=200,u=200,m=c/t,p=u/s;g.value=Math.min(m,p),x.x=(c-t*g.value)/2,x.y=(u-s*g.value)/2;const d=f.value;d.width=200,d.height=200}function L(e){if(!v.value)return;const t=w.value.getBoundingClientRect(),s=e.clientX-t.left,c=e.clientY-t.top;o.push({x:s,y:c}),S()}function S(){const e=f.value.getContext("2d");if(e.clearRect(0,0,200,200),o.length!==0){e.beginPath(),e.strokeStyle="red",e.lineWidth=2,e.moveTo(o[0].x,o[0].y);for(let t=1;t<o.length;t++)e.lineTo(o[t].x,o[t].y);e.stroke(),o.forEach(t=>{e.beginPath(),e.arc(t.x,t.y,3,0,Math.PI*2),e.fillStyle="red",e.fill()})}}function T(){o.length<3||U()}function U(){const e=b.value,t=o.map(a=>({x:(a.x-x.x)/g.value,y:(a.y-x.y)/g.value})),s=t.map(a=>a.x),c=t.map(a=>a.y),u=Math.min(...s),m=Math.min(...c),p=Math.max(...s),d=Math.max(...c),B=p-u,N=d-m,h=document.createElement("canvas");h.width=B,h.height=N;const l=h.getContext("2d");l.save(),l.beginPath(),t.forEach((a,V)=>{const P=a.x-u,_=a.y-m;V===0?l.moveTo(P,_):l.lineTo(P,_)}),l.closePath(),l.clip(),l.drawImage(e,-u,-m),l.restore(),y.value=h.toDataURL("image/png")}return(e,t)=>(C(),k("div",null,[n("input",{type:"file",onChange:H},null,32),n("div",{class:"img-box",ref_key:"boxRef",ref:w,onClick:L},[n("img",{ref_key:"imgRef",ref:b,src:R.value,onLoad:D,class:"img"},null,40,j),Y(n("canvas",{ref_key:"canvasRef",ref:f,class:"draw-canvas"},null,512),[[O,v.value]])],512),t[0]||(t[0]=n("br",null,null,-1)),n("button",{onClick:W},E(o.length===0?"钢笔":"重置钢笔"),1),v.value&&o.length>=3?(C(),k("button",{key:0,onClick:T}," 完成圈选")):M("",!0),t[1]||(t[1]=n("br",null,null,-1)),t[2]||(t[2]=r(" 坐标数据： ",-1)),n("div",null,E(o),1),t[3]||(t[3]=n("div",{style:{border:"1px solid red"}},[r(" 上传图片 "),n("br"),r(" 等比例显示在容器内"),n("br"),r(" 点击钢笔 "),n("br"),r(" 至少点 3 个点，形成一个 不规则多边形圈选区域"),n("br"),r(" 点击确定按钮"),n("br"),r(" 根据多边形区域裁剪原图真实像素，显示裁剪结果(原图) ")],-1)),t[4]||(t[4]=n("h3",null,"裁剪结果：",-1)),y.value?(C(),k("img",{key:1,src:y.value,style:{width:"200px"}},null,8,z)):M("",!0)]))}},q=X(J,[["__scopeId","data-v-f325866b"]]);export{q as default};
