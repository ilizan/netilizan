import{M as K}from"./index-vlQPJhmJ.js";import{bO as X,aS as u,q as C,bC as G,u as _,v as a,I as n,bi as J,aX as h,bH as f,b9 as U,av as Q,as as S,aK as z,H as I}from"./index-BAi-_Ng5.js";const Y={class:"advanced-image-cropper"},Z={key:1,class:"cropper-container"},ee={class:"cropper-wrapper"},te={class:"crop-controls"},oe={class:"control-item"},ae={class:"control-item"},le={class:"control-item"},ie={class:"preview-area"},ne={class:"preview-title"},se=["src"],re={class:"action-buttons"},ue={__name:"VueCropper1",props:{imageUrl:{type:String,default:""},cropPosition:{type:Object,default:()=>({x:0,y:0})},cropSize:{type:Object,default:()=>({width:300,height:300})},previewSize:{type:Object,default:()=>({width:200,height:200})}},emits:["crop-complete","crop-data-update","cancel"],setup(w,{emit:D}){const p=w,g=D,V=u(null),s=u(null),r=u(""),l=u({...p.cropSize}),k=u({...p.cropPosition}),c=u("free"),R=u(""),d=u({width:0,height:0}),B=C(()=>{if(c.value==="free")return[0,0];const[t,e]=c.value.split(":").map(Number);return[t,e]}),A=C(()=>({width:d.value.width||2e3,height:d.value.height||2e3})),N=C(()=>({width:`${p.previewSize.width}px`,height:`${p.previewSize.height}px`}));G(()=>p.imageUrl,async t=>{t?await O(t):r.value=""},{immediate:!0});const O=async t=>{try{if(t.startsWith("data:image"))r.value=t,await b(t);else if(t.startsWith("http")){const o=await(await fetch(t)).blob(),i=await P(o);r.value=i,await b(i)}else r.value=t;S(()=>{M()})}catch(e){console.error("图片加载错误:",e)}},b=t=>new Promise(e=>{const o=new Image;o.onload=()=>{d.value={width:o.width,height:o.height},e()},o.src=t}),P=t=>new Promise(e=>{const o=new FileReader;o.onload=i=>e(i.target.result),o.readAsDataURL(t)}),M=()=>{s.value&&S(()=>{s.value.goAutoCrop(),p.cropPosition.x!==0||p.cropPosition.y})},T=()=>{var t;(t=V.value)==null||t.click()},F=async t=>{const e=t.target.files[0];if(!e||!e.type.startsWith("image/")||e.size>10*1024*1024)return;const o=await P(e);r.value=o,await b(o),M(),t.target.value=""},L=()=>{s.value.cropW=100,s.value.cropH=200},W=t=>{s.value.getCropData(e=>{R.value=e})},j=t=>{console.log(t),k.value={x:Math.round(t.x||0),y:Math.round(t.y||0)},g("crop-data-update",{position:{...k.value},size:{...l.value}})},y=()=>{s.value&&S(()=>{s.value.goAutoCrop()})},H=t=>{if(t==="free"){c.value="free";return}const[e,o]=t.split(":").map(Number);l.value.width/l.value.height>e/o?l.value.height=Math.round(l.value.width*o/e):l.value.width=Math.round(l.value.height*e/o),y()},$=()=>{s.value&&s.value.getCropBlob(t=>{const e=new FileReader;e.onload=o=>{const i=o.target.result,x=s.value.getImgAxis(),v=s.value.getCropAxis();console.log(x,v),g("crop-complete",{imageData:i})},e.readAsDataURL(t)})},q=()=>{g("crop-complete",{imageData:r.value,cropInfo:{position:{x:0,y:0},size:{...d.value},originalImageSize:{...d.value}}})},E=()=>{r.value="",g("cancel")};return(t,e)=>{const o=h("el-input-number"),i=h("el-option"),x=h("el-select"),v=h("el-button");return z(),_("div",Y,[r.value?(z(),_("div",Z,[a("div",ee,[n(J(K),{ref_key:"cropperRef",ref:s,img:r.value,"output-size":1,"output-type":"png",info:!0,full:!0,fixed:!1,"fixed-number":B.value,"center-box":!1,"info-true":!0,"auto-crop":!0,"auto-crop-width":l.value.width,"auto-crop-height":l.value.height,enlarge:1,"can-move":!0,"can-move-box":!0,original:!1,onImgLoad:L,onRealTime:W,onCropMoving:j},null,8,["img","fixed-number","auto-crop-width","auto-crop-height"]),a("div",te,[a("div",oe,[e[4]||(e[4]=a("span",null,"宽度:",-1)),n(o,{modelValue:l.value.width,"onUpdate:modelValue":e[0]||(e[0]=m=>l.value.width=m),min:50,max:A.value.width,onChange:y},null,8,["modelValue","max"])]),a("div",ae,[e[5]||(e[5]=a("span",null,"高度:",-1)),n(o,{modelValue:l.value.height,"onUpdate:modelValue":e[1]||(e[1]=m=>l.value.height=m),min:50,max:A.value.height,onChange:y},null,8,["modelValue","max"])]),a("div",le,[e[6]||(e[6]=a("span",null,"比例:",-1)),n(x,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=m=>c.value=m),onChange:H},{default:f(()=>[n(i,{label:"自由比例",value:"free"}),n(i,{label:"1:1",value:"1:1"}),n(i,{label:"4:3",value:"4:3"}),n(i,{label:"16:9",value:"16:9"}),n(i,{label:"3:4",value:"3:4"}),n(i,{label:"9:16",value:"9:16"})]),_:1},8,["modelValue"])])])]),a("div",ie,[a("div",ne,"预览 ("+U(w.previewSize.width)+"×"+U(w.previewSize.height)+")",1),a("div",{class:"preview-image",style:Q(N.value)},[a("img",{src:R.value,alt:"预览"},null,8,se)],4)]),a("div",re,[n(v,{onClick:E},{default:f(()=>[...e[7]||(e[7]=[I("取消",-1)])]),_:1}),n(v,{type:"primary",onClick:$},{default:f(()=>[...e[8]||(e[8]=[I("确认裁剪",-1)])]),_:1}),n(v,{onClick:q},{default:f(()=>[...e[9]||(e[9]=[I("使用原图",-1)])]),_:1})])])):(z(),_("div",{key:0,class:"upload-area",onClick:T},[e[3]||(e[3]=a("span",null,"点击选择图片",-1)),a("input",{ref_key:"fileInput",ref:V,type:"file",accept:"image/*",style:{display:"none"},onChange:F},null,544)]))])}}},de=X(ue,[["__scopeId","data-v-409873f8"]]);export{de as default};
