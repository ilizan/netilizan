import{bO as J,aS as p,q as Q,bC as D,u as h,H as n,v as a,b9 as r,I as v,bH as f,aX as S,t as Y,bi as Z,av as ee,F as te,aV as oe,as as H,aK as y,at as ae,bM as le}from"./index-BAi-_Ng5.js";import{M as se}from"./index-vlQPJhmJ.js";const re={class:"advanced-image-cropper"},ie={key:1,class:"cropper-container"},ne={class:"cropper-wrapper",style:{width:"460px",height:"460px"}},ue={class:"preview-area"},ce={class:"preview-title"},pe=["src"],ve={class:"action-buttons"},de={key:0,class:"crop-history"},ge={class:"history-list"},me=["onClick"],he=["src"],fe={class:"history-info"},ye={__name:"VueCropper2",props:{imageUrl:{type:String,default:""},cropConfig:{type:Object,default:()=>({x:0,y:0,width:200,height:200})},cropHistoryData:{type:Array,default:()=>[]},previewSize:{type:Object,default:()=>({width:200,height:200})}},emits:["crop-complete","crop-list-update","crop-data-update","cancel"],setup(I,{expose:U,emit:V}){const d=I,u=V,M=p(null),s=p(null),i=p(""),g=p({...d.cropConfig.size}),w=p(""),C=p({width:0,height:0}),l=p([...d.cropHistoryData]),m=p(-1),E=Q(()=>({width:`${d.previewSize.width}px`,height:`${d.previewSize.height}px`}));D(()=>d.imageUrl,async e=>{e?await F(e):i.value=""},{immediate:!0}),D(()=>d.cropHistoryData,e=>{l.value=[...e]},{deep:!0}),D(()=>d.cropConfig,e=>{g.value={...e}},{deep:!0});const F=async e=>{try{if(e.startsWith("data:image"))i.value=e,await k(e);else if(e.startsWith("http")){const o=await(await fetch(e)).blob(),c=await R(o);i.value=c,await k(c)}else i.value=e;H(()=>{B()})}catch(t){ElMessage.error("图片加载失败"),console.error("图片加载错误:",t)}},k=e=>new Promise(t=>{const o=new Image;o.onload=()=>{C.value={width:o.width,height:o.height},t()},o.src=e}),R=e=>new Promise(t=>{const o=new FileReader;o.onload=c=>t(c.target.result),o.readAsDataURL(e)}),B=()=>{s.value&&H(()=>{s.value.goAutoCrop()})},L=()=>{var e;(e=M.value)==null||e.click()},P=async e=>{const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){ElMessage.error("请选择图片文件");return}if(t.size>10*1024*1024){ElMessage.error("图片大小不能超过10MB");return}const o=await R(t);i.value=o,await k(o),B(),e.target.value=""},T=()=>{console.log(s.value),s.value.goAutoCrop(),H(()=>{s.value.setCropBoxData({left:10,top:20,width:100,height:200})})},W=e=>{s.value.getCropData(t=>{w.value=t})},A=e=>{console.log("实时预览回调",e),console.log(s.value);let t=s.value.cropW,o=s.value.cropH;console.log("cropW",t),console.log("cropH",o),g.value.width=t||0,g.value.height=o||0,u("crop-data-update",{...g.value})},N=e=>{console.log("图片移动回调函数",e)},z=async()=>new Promise(e=>{s.value.getCropBlob(t=>{const o=new FileReader;o.onload=c=>{e({imageData:c.target.result,cropInfo:{originalImageSize:{...C.value}},previewUrl:w.value,timestamp:Date.now()})},o.readAsDataURL(t)})}),O=async()=>{if(!s.value)return;const e=await z();console.log("裁剪数据:",e),w.value=e.imageData,u("crop-complete",e)},$=async()=>{if(!s.value)return;const e=await z();l.value.push(e),m.value=l.value.length-1,u("crop-list-update",l.value)},j=(e,t)=>{},q=e=>{l.value.splice(e,1),m.value===e&&(m.value=-1),u("crop-list-update",l.value),ElMessage.success("已删除裁剪历史")},K=()=>{const e={imageData:i.value,cropInfo:{position:{x:0,y:0},size:{...C.value},originalImageSize:{...C.value}},previewUrl:i.value,timestamp:Date.now()};u("crop-complete",e),ElMessage.success("使用原图")},X=()=>{i.value="",u("cancel")};return U({addCropData:async e=>{e&&(l.value.push(e),u("crop-list-update",l.value))},clearCropHistory:()=>{l.value=[],m.value=-1,u("crop-list-update",l.value)},getCurrentCropData:z,getCropHistory:()=>l.value}),(e,t)=>{const o=S("Plus"),c=S("el-icon"),b=S("el-button");return y(),h("div",re,[n(" 1"+r(C.value),1),t[6]||(t[6]=a("br",null,null,-1)),n(" 2"+r(g.value),1),t[7]||(t[7]=a("br",null,null,-1)),n(" 3"+r(m.value),1),t[8]||(t[8]=a("br",null,null,-1)),n(" 4"+r(w.value),1),t[9]||(t[9]=a("br",null,null,-1)),i.value?(y(),h("div",ie,[a("div",ne,[v(Z(se),{ref_key:"cropperRef",ref:s,img:i.value,"output-size":1,"output-type":"png",info:!0,full:!0,fixed:!1,"center-box":!0,"info-true":!0,"auto-crop":!0,"auto-crop-width":g.value.width,"auto-crop-height":g.value.height,enlarge:1,"can-move":!0,"can-move-box":!0,original:!1,onImgLoad:T,onRealTime:W,onCropMoving:A,onImgMoving:N},null,8,["img","auto-crop-width","auto-crop-height"])]),a("div",ue,[a("div",ce,"预览 ("+r(I.previewSize.width)+"×"+r(I.previewSize.height)+")",1),a("div",{class:"preview-image",style:ee(E.value)},[a("img",{src:w.value,alt:"预览"},null,8,pe)],4)]),a("div",ve,[v(b,{onClick:X},{default:f(()=>[...t[1]||(t[1]=[n("取消",-1)])]),_:1}),v(b,{type:"primary",onClick:O},{default:f(()=>[...t[2]||(t[2]=[n("确认裁剪",-1)])]),_:1}),v(b,{onClick:K},{default:f(()=>[...t[3]||(t[3]=[n("使用原图",-1)])]),_:1}),v(b,{onClick:$,type:"success"},{default:f(()=>[...t[4]||(t[4]=[n("添加到裁剪列表",-1)])]),_:1})]),l.value.length>0?(y(),h("div",de,[a("h4",null,"裁剪历史 ("+r(l.value.length)+")",1),a("div",ge,[(y(!0),h(te,null,oe(l.value,(_,x)=>(y(),h("div",{key:x,class:ae(["history-item",{active:m.value===x}]),onClick:G=>j()},[a("img",{src:_.previewUrl,alt:"历史裁剪"},null,8,he),a("div",fe,[a("div",null,"尺寸: "+r(_.cropInfo.size.width)+"×"+r(_.cropInfo.size.height),1),a("div",null,"位置: ("+r(_.cropInfo.position.x)+", "+r(_.cropInfo.position.y)+")",1)]),v(b,{size:"small",type:"danger",onClick:le(G=>q(x),["stop"])},{default:f(()=>[...t[5]||(t[5]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])],10,me))),128))])])):Y("",!0)])):(y(),h("div",{key:0,class:"upload-area",onClick:L},[v(c,null,{default:f(()=>[v(o)]),_:1}),t[0]||(t[0]=a("span",null,"点击选择图片",-1)),a("input",{ref_key:"fileInput",ref:M,type:"file",accept:"image/*",style:{display:"none"},onChange:P},null,544)]))])}}},be=J(ye,[["__scopeId","data-v-9a8ef41c"]]);export{be as default};
